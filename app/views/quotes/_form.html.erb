<!-- This will display errors related to both the Quote and its nested QuoteGategories -->
<% if @quote.errors.any? %>
  <div class="alert alert-danger">
    <ul>
      <% @quote.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>


  <!-- Hidden field for user_id -->
  <%= f.hidden_field :user_id, value: current_user.id %>

  <!-- Form fields associated with the quotes table -->

  <!-- Quote text body -->
  <div class="form-group" style="padding-bottom: 10px;">
    <%= f.text_area :textbody, placeholder: 'Enter quote text', class: 'form-control' %>
  </div>

  <!-- Publication year -->
  <div class="form-group" style="padding-bottom: 10px;">
    <%= f.number_field :pubyear, placeholder: 'Publication year (optional)', class: 'form-control' %>
  </div>


  <!-- Comment -->
  <div class="form-group" style="padding-bottom: 10px;">
    <%= f.text_area :comment, placeholder: 'Comment (optional)', class: 'form-control' %>
  </div>



  <!-- Public checkbox -->
  <div class="form-check" style="padding-bottom: 10px;">
    <%= f.label :is_public do %>
      Public
      <%= f.check_box :is_public, class: "form-check-input" %>
    <% end %>
  </div>

  <h3>Author Details</h3> <%# This author section was created with the help of copilot %>
  <%= f.fields_for :author do |a| %>
    <%= a.label :auth_fname, "First Name" %>
    <%= a.text_field :auth_fname, class: "form-control" %><br>
    <%= a.label :auth_surname, "Surname" %>
    <%= a.text_field :auth_surname, class: "form-control" %><br>
    <%= a.label :birthyear, "Birth Year" %>
    <%= a.text_field :birthyear, class: "form-control" %><br>
    <%= a.label :deathyear, "Death Year" %>
    <%= a.text_field :deathyear, class: "form-control" %><br>
    <%= a.label :biography, "Biography" %>
    <%= a.text_area :biography, class: "form-control" %>
  <% end %>


  <!-- Category selection (nested form for quote_categories) -->
  <div id="categories-container">
    <% @quote.quote_categories.each do |quote_category| %>
      <%= f.fields_for :quote_categories, quote_category do |qc| %>
        <div class="category-field row mb-2">
          <div class="col-auto">
            <%= qc.label :category_id, "Category", class: "form-label d-inline-block me-2" %>
            <%= qc.select :category_id, Category.all.collect { |cat| [cat.cat_name, cat.id] }, { include_blank: true }, class: "form-control d-inline-block" %>
          </div>

          <div class="col-auto align-self-end">
            <%= link_to '[-] Remove this category', '#', class: 'remove-category', style: "color: red; text-decoration: none;" %> <!-- Allow users to remove a field -->
          </div>
        </div>
      <% end %>
    <% end %>
  </div>









<script>
// Wait for the document to be fully loaded
document.addEventListener('DOMContentLoaded', function() {
  // Attach an event listener to detect clicks on the "Remove this category" link
  document.addEventListener('click', function(e) {
    if (e.target && e.target.classList.contains('remove-category')) {
      // Prevent the default action of the link
      e.preventDefault();

      // Get all the category fields
      const categoryFields = document.querySelectorAll('.category-field');
      // Only remove a category field if there's more than one
      if (categoryFields.length > 1) {
        e.target.closest('.category-field').remove();
      }
    }
  });
});
</script>
